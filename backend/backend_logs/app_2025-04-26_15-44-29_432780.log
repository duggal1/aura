2025-04-26 15:44:37.996 | INFO     | app.main:lifespan:14 - Starting application...
2025-04-26 15:44:38.004 | INFO     | app.logging_setup:start_metrics_server:76 - Prometheus metrics server started on port 8001
2025-04-26 15:44:38.010 | INFO     | app.cache:init_redis_pool:30 - Successfully connected to Redis at redis://localhost:6379/0
2025-04-26 15:44:38.010 | INFO     | app.emotion_pipeline:load_models:26 - Attempting to load models on device: cpu
2025-04-26 15:44:39.943 | INFO     | app.emotion_pipeline:load_models:40 - Successfully loaded emotion model: j-hartmann/emotion-english-distilroberta-base
2025-04-26 15:44:39.943 | INFO     | app.emotion_pipeline:load_models:42 - Loaded emotion model labels from config: ['anger', 'disgust', 'fear', 'joy', 'neutral', 'sadness', 'surprise']
2025-04-26 15:44:40.704 | INFO     | app.emotion_pipeline:load_models:58 - Successfully loaded sentiment model.
2025-04-26 15:44:42.305 | INFO     | app.emotion_pipeline:load_models:75 - Successfully loaded sarcasm model: jkhan447/sarcasm-detection-RoBerta-base-POS
2025-04-26 15:44:42.306 | INFO     | app.emotion_pipeline:load_models:77 - Loaded sarcasm model labels from config: ['LABEL_0', 'LABEL_1']
2025-04-26 15:44:42.348 | INFO     | app.llm_service:configure_genai:16 - Google GenAI client configured.
2025-04-26 15:44:42.350 | INFO     | app.main:lifespan:22 - Redis cache cleared on startup.
2025-04-26 15:44:42.350 | INFO     | app.main:lifespan:25 - Startup complete.
2025-04-26 15:44:42.352 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_6845ad00] Chat request: 'hey!...'
2025-04-26 15:44:42.352 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:44:42.352 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:44:42.524 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'joy': 0.6358238458633423, 'surprise': 0.3000810444355011, 'neutral': 0.027769161388278008, 'anger': 0.02397848106920719, 'sadness': 0.005755686201155186, 'disgust': 0.003386283991858363, 'fear': 0.0032054574694484472}
2025-04-26 15:44:42.524 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'happy': 0.63581, 'surprised': 0.30008, 'neutral': 0.02777, 'angry': 0.02398, 'sad': 0.00576, 'disgusted': 0.00339, 'fearful': 0.00321}
2025-04-26 15:44:42.524 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=happy (0.636)
2025-04-26 15:44:42.525 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.1733 seconds.
2025-04-26 15:44:42.526 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:44:44.922 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:44:44.923 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:44:45.010 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'joy': 0.9780210852622986, 'surprise': 0.012562463991343975, 'neutral': 0.004079874604940414, 'sadness': 0.0032025424297899008, 'anger': 0.0013929881388321519, 'disgust': 0.0005249715177342296, 'fear': 0.00021596688020508736}
2025-04-26 15:44:45.011 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'happy': 0.97802, 'surprised': 0.01256, 'neutral': 0.00408, 'sad': 0.0032, 'angry': 0.00139, 'disgusted': 0.00052, 'fearful': 0.00022}
2025-04-26 15:44:45.011 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=happy (0.978)
2025-04-26 15:44:45.013 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0906 seconds.
2025-04-26 15:44:45.013 | INFO     | app.llm_service:validate_response:44 - Response validated: matches expected emotion happy
2025-04-26 15:44:45.013 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 2.4873 seconds.
2025-04-26 15:44:45.014 | INFO     | app.main:chat_endpoint:125 - [ReqID: req_6845ad00] Response cached.
2025-04-26 15:44:45.014 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_6845ad00] Processed in 2.6625s.
2025-04-26 15:44:51.492 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_be5e1221] Chat request: 'hey “I don’t even know how to explain this mess I’...'
2025-04-26 15:44:51.493 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:44:51.493 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:44:51.652 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'fear': 0.9285853505134583, 'sadness': 0.031241638585925102, 'anger': 0.025762267410755157, 'surprise': 0.007981525734066963, 'joy': 0.0025411408860236406, 'neutral': 0.0022498611360788345, 'disgust': 0.001638190820813179}
2025-04-26 15:44:51.653 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'fearful': 0.92859, 'sad': 0.03124, 'angry': 0.02576, 'surprised': 0.00798, 'happy': 0.00254, 'neutral': 0.00225, 'disgusted': 0.00164}
2025-04-26 15:44:51.653 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=fearful (0.929)
2025-04-26 15:44:51.654 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.1613 seconds.
2025-04-26 15:44:51.654 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:44:53.418 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:44:53.419 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:44:53.497 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'fear': 0.9814993739128113, 'joy': 0.006706725340336561, 'surprise': 0.006001501809805632, 'neutral': 0.0024704250972718, 'anger': 0.0019051317358389497, 'sadness': 0.0009070336236618459, 'disgust': 0.0005098056280985475}
2025-04-26 15:44:53.497 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'fearful': 0.98149, 'happy': 0.00671, 'surprised': 0.006, 'neutral': 0.00247, 'angry': 0.00191, 'sad': 0.00091, 'disgusted': 0.00051}
2025-04-26 15:44:53.497 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=fearful (0.981)
2025-04-26 15:44:53.498 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0800 seconds.
2025-04-26 15:44:53.498 | INFO     | app.llm_service:validate_response:44 - Response validated: matches expected emotion fearful
2025-04-26 15:44:53.498 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 1.8444 seconds.
2025-04-26 15:44:53.499 | INFO     | app.main:chat_endpoint:125 - [ReqID: req_be5e1221] Response cached.
2025-04-26 15:44:53.499 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_be5e1221] Processed in 2.0075s.
2025-04-26 15:44:57.620 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_583ca275] Chat request: 'yea?...'
2025-04-26 15:44:57.622 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:44:57.623 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:44:57.715 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'surprise': 0.910160481929779, 'anger': 0.02707172930240631, 'disgust': 0.026323478668928146, 'neutral': 0.023764895275235176, 'joy': 0.005984952673316002, 'sadness': 0.004215078428387642, 'fear': 0.002479390474036336}
2025-04-26 15:44:57.715 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'surprised': 0.91017, 'angry': 0.02707, 'disgusted': 0.02632, 'neutral': 0.02376, 'happy': 0.00598, 'sad': 0.00422, 'fearful': 0.00248}
2025-04-26 15:44:57.716 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=surprised (0.910)
2025-04-26 15:44:57.716 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0943 seconds.
2025-04-26 15:44:57.716 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:44:58.945 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:44:58.946 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:44:59.020 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'surprise': 0.9231380224227905, 'joy': 0.04972049966454506, 'neutral': 0.009291289374232292, 'anger': 0.00923244934529066, 'fear': 0.005730025004595518, 'sadness': 0.0015434195520356297, 'disgust': 0.0013442450435832143}
2025-04-26 15:44:59.021 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'surprised': 0.92315, 'happy': 0.04972, 'neutral': 0.00929, 'angry': 0.00923, 'fearful': 0.00573, 'sad': 0.00154, 'disgusted': 0.00134}
2025-04-26 15:44:59.021 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=surprised (0.923)
2025-04-26 15:44:59.022 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0763 seconds.
2025-04-26 15:44:59.022 | INFO     | app.llm_service:validate_response:44 - Response validated: matches expected emotion surprised
2025-04-26 15:44:59.022 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 1.3056 seconds.
2025-04-26 15:44:59.022 | INFO     | app.main:chat_endpoint:125 - [ReqID: req_583ca275] Response cached.
2025-04-26 15:44:59.023 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_583ca275] Processed in 1.4021s.
2025-04-26 15:45:02.336 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_d50687b4] Chat request: 'okay...'
2025-04-26 15:45:02.337 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:02.338 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:02.427 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'neutral': 0.4656863212585449, 'surprise': 0.3176921010017395, 'joy': 0.14012189209461212, 'sadness': 0.06323384493589401, 'anger': 0.005717871244996786, 'fear': 0.0039479490369558334, 'disgust': 0.003600002033635974}
2025-04-26 15:45:02.428 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'neutral': 0.46569, 'surprised': 0.31769, 'happy': 0.14012, 'sad': 0.06323, 'angry': 0.00572, 'fearful': 0.00395, 'disgusted': 0.0036}
2025-04-26 15:45:02.428 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=neutral (0.466)
2025-04-26 15:45:02.429 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0918 seconds.
2025-04-26 15:45:02.429 | WARNING  | app.main:chat_endpoint:97 - [ReqID: req_d50687b4] Low-confidence emotion detected.
2025-04-26 15:45:02.429 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:45:03.860 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:03.860 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:03.941 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'surprise': 0.6212381720542908, 'fear': 0.3548717796802521, 'anger': 0.008313441649079323, 'neutral': 0.006881412584334612, 'sadness': 0.0040564630180597305, 'disgust': 0.0025322134606540203, 'joy': 0.0021065324544906616}
2025-04-26 15:45:03.941 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'surprised': 0.62124, 'fearful': 0.35487, 'angry': 0.00831, 'neutral': 0.00688, 'sad': 0.00406, 'disgusted': 0.00253, 'happy': 0.00211}
2025-04-26 15:45:03.942 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=surprised (0.621)
2025-04-26 15:45:03.942 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0826 seconds.
2025-04-26 15:45:03.943 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected neutral, got surprised
2025-04-26 15:45:03.943 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 1. Retrying...
2025-04-26 15:45:05.608 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:05.609 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:05.698 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'fear': 0.6305109858512878, 'surprise': 0.2832378149032593, 'neutral': 0.034621838480234146, 'anger': 0.01802303083240986, 'disgust': 0.01715037040412426, 'sadness': 0.01175315584987402, 'joy': 0.004702857695519924}
2025-04-26 15:45:05.699 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'fearful': 0.63051, 'surprised': 0.28324, 'neutral': 0.03462, 'angry': 0.01802, 'disgusted': 0.01715, 'sad': 0.01175, 'happy': 0.0047}
2025-04-26 15:45:05.699 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=fearful (0.631)
2025-04-26 15:45:05.700 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0914 seconds.
2025-04-26 15:45:05.700 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected neutral, got fearful
2025-04-26 15:45:05.700 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 2. Retrying...
2025-04-26 15:45:05.700 | WARNING  | app.llm_service:refine_and_respond:108 - Max validation attempts reached. Using fallback.
2025-04-26 15:45:05.700 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 3.2713 seconds.
2025-04-26 15:45:05.701 | INFO     | app.main:chat_endpoint:127 - [ReqID: req_d50687b4] Skipped caching due to low-confidence emotion (score: 0.46569).
2025-04-26 15:45:05.701 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_d50687b4] Processed in 3.3647s.
2025-04-26 15:45:28.132 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_80104a4a] Chat request: 'mmmmhmmm but can u fucking help me digitical piece...'
2025-04-26 15:45:28.133 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:28.133 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:28.216 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'disgust': 0.4132613241672516, 'anger': 0.34939587116241455, 'surprise': 0.06683927029371262, 'sadness': 0.06628934293985367, 'fear': 0.048736508935689926, 'neutral': 0.048415716737508774, 'joy': 0.0070619103498756886}
2025-04-26 15:45:28.216 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'disgusted': 0.41326, 'angry': 0.3494, 'surprised': 0.06684, 'sad': 0.06629, 'fearful': 0.04874, 'neutral': 0.04842, 'happy': 0.00706}
2025-04-26 15:45:28.216 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=disgusted (0.413)
2025-04-26 15:45:28.217 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0845 seconds.
2025-04-26 15:45:28.217 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:45:30.895 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:30.895 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:30.973 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'anger': 0.8427597284317017, 'sadness': 0.07278954982757568, 'surprise': 0.04571950435638428, 'disgust': 0.014453726820647717, 'neutral': 0.014229405671358109, 'fear': 0.0068223378621041775, 'joy': 0.0032256622798740864}
2025-04-26 15:45:30.973 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'angry': 0.84276, 'sad': 0.07279, 'surprised': 0.04572, 'disgusted': 0.01445, 'neutral': 0.01423, 'fearful': 0.00682, 'happy': 0.00323}
2025-04-26 15:45:30.973 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=angry (0.843)
2025-04-26 15:45:30.974 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0793 seconds.
2025-04-26 15:45:30.974 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected disgusted, got angry
2025-04-26 15:45:30.974 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 1. Retrying...
2025-04-26 15:45:32.327 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:32.327 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:32.401 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'anger': 0.8139304518699646, 'surprise': 0.09833411127328873, 'fear': 0.061970535665750504, 'sadness': 0.01057594083249569, 'joy': 0.0061088926158845425, 'neutral': 0.005425984971225262, 'disgust': 0.003654039464890957}
2025-04-26 15:45:32.401 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'angry': 0.81393, 'surprised': 0.09833, 'fearful': 0.06197, 'sad': 0.01058, 'happy': 0.00611, 'neutral': 0.00543, 'disgusted': 0.00365}
2025-04-26 15:45:32.401 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=angry (0.814)
2025-04-26 15:45:32.402 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0751 seconds.
2025-04-26 15:45:32.402 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected disgusted, got angry
2025-04-26 15:45:32.402 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 2. Retrying...
2025-04-26 15:45:32.402 | WARNING  | app.llm_service:refine_and_respond:108 - Max validation attempts reached. Using fallback.
2025-04-26 15:45:32.402 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 4.1854 seconds.
2025-04-26 15:45:32.403 | INFO     | app.main:chat_endpoint:127 - [ReqID: req_80104a4a] Skipped caching due to low-confidence emotion (score: 0.41326).
2025-04-26 15:45:32.403 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_80104a4a] Processed in 4.2712s.
2025-04-26 15:45:39.175 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_4c5e6450] Chat request: 'yea?? really...'
2025-04-26 15:45:39.175 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:39.176 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:39.260 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'surprise': 0.9638738036155701, 'neutral': 0.014822016470134258, 'anger': 0.008375106379389763, 'disgust': 0.005407400894910097, 'joy': 0.0031720062252134085, 'sadness': 0.0028319424018263817, 'fear': 0.001517776632681489}
2025-04-26 15:45:39.260 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'surprised': 0.96387, 'neutral': 0.01482, 'angry': 0.00838, 'disgusted': 0.00541, 'happy': 0.00317, 'sad': 0.00283, 'fearful': 0.00152}
2025-04-26 15:45:39.260 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=surprised (0.964)
2025-04-26 15:45:39.261 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0856 seconds.
2025-04-26 15:45:39.261 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:45:42.056 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:42.056 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:42.139 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'anger': 0.42849811911582947, 'surprise': 0.4137238562107086, 'disgust': 0.10152410715818405, 'fear': 0.019552553072571754, 'neutral': 0.013457424007356167, 'sadness': 0.012225921265780926, 'joy': 0.011018035933375359}
2025-04-26 15:45:42.139 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'angry': 0.4285, 'surprised': 0.41372, 'disgusted': 0.10152, 'fearful': 0.01955, 'neutral': 0.01346, 'sad': 0.01223, 'happy': 0.01102}
2025-04-26 15:45:42.139 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=angry (0.428)
2025-04-26 15:45:42.140 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0844 seconds.
2025-04-26 15:45:42.140 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected surprised, got angry
2025-04-26 15:45:42.141 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 1. Retrying...
2025-04-26 15:45:43.386 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:43.387 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:43.468 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'sadness': 0.42185619473457336, 'surprise': 0.4027916491031647, 'joy': 0.07380746304988861, 'anger': 0.05174282565712929, 'neutral': 0.022511767223477364, 'disgust': 0.01938614249229431, 'fear': 0.00790390558540821}
2025-04-26 15:45:43.468 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'sad': 0.42186, 'surprised': 0.40279, 'happy': 0.07381, 'angry': 0.05174, 'neutral': 0.02251, 'disgusted': 0.01939, 'fearful': 0.0079}
2025-04-26 15:45:43.468 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=sad (0.422)
2025-04-26 15:45:43.469 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0823 seconds.
2025-04-26 15:45:43.469 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected surprised, got sad
2025-04-26 15:45:43.469 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 2. Retrying...
2025-04-26 15:45:43.469 | WARNING  | app.llm_service:refine_and_respond:108 - Max validation attempts reached. Using fallback.
2025-04-26 15:45:43.470 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 4.2085 seconds.
2025-04-26 15:45:43.470 | INFO     | app.main:chat_endpoint:125 - [ReqID: req_4c5e6450] Response cached.
2025-04-26 15:45:43.470 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_4c5e6450] Processed in 4.2957s.
2025-04-26 15:45:47.658 | INFO     | app.main:chat_endpoint:74 - [ReqID: req_be68ce9e] Chat request: 'okay...'
2025-04-26 15:45:47.659 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:47.659 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:47.746 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'neutral': 0.4656863212585449, 'surprise': 0.3176921010017395, 'joy': 0.14012189209461212, 'sadness': 0.06323384493589401, 'anger': 0.005717871244996786, 'fear': 0.0039479490369558334, 'disgust': 0.003600002033635974}
2025-04-26 15:45:47.746 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'neutral': 0.46569, 'surprised': 0.31769, 'happy': 0.14012, 'sad': 0.06323, 'angry': 0.00572, 'fearful': 0.00395, 'disgusted': 0.0036}
2025-04-26 15:45:47.747 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=neutral (0.466)
2025-04-26 15:45:47.747 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0885 seconds.
2025-04-26 15:45:47.747 | WARNING  | app.main:chat_endpoint:97 - [ReqID: req_be68ce9e] Low-confidence emotion detected.
2025-04-26 15:45:47.748 | INFO     | app.utils:wrapper:107 - Starting 'LLM Emotion + Response'...
2025-04-26 15:45:49.221 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:49.222 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:49.298 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'joy': 0.7240782976150513, 'surprise': 0.12642167508602142, 'neutral': 0.09472812712192535, 'anger': 0.0345979779958725, 'disgust': 0.008810510858893394, 'fear': 0.006201206240803003, 'sadness': 0.005162253975868225}
2025-04-26 15:45:49.299 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'happy': 0.72408, 'surprised': 0.12642, 'neutral': 0.09473, 'angry': 0.0346, 'disgusted': 0.00881, 'fearful': 0.0062, 'sad': 0.00516}
2025-04-26 15:45:49.299 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=happy (0.724)
2025-04-26 15:45:49.300 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0789 seconds.
2025-04-26 15:45:49.300 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected neutral, got happy
2025-04-26 15:45:49.300 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 1. Retrying...
2025-04-26 15:45:50.452 | INFO     | app.utils:wrapper:107 - Starting 'Advanced Emotion Analysis'...
2025-04-26 15:45:50.453 | INFO     | app.emotion_pipeline:load_models:22 - Models already loaded.
2025-04-26 15:45:50.530 | INFO     | app.emotion_pipeline:map_emotions:159 - Raw distribution: {'joy': 0.5911321043968201, 'surprise': 0.2481820434331894, 'neutral': 0.10261017829179764, 'anger': 0.030704108998179436, 'sadness': 0.01187965553253889, 'fear': 0.008394841104745865, 'disgust': 0.0070971474051475525}
2025-04-26 15:45:50.530 | INFO     | app.emotion_pipeline:map_emotions:160 - Mapped distribution: {'happy': 0.59113, 'surprised': 0.24818, 'neutral': 0.10261, 'angry': 0.0307, 'sad': 0.01188, 'fearful': 0.00839, 'disgusted': 0.0071}
2025-04-26 15:45:50.531 | INFO     | app.emotion_pipeline:analyze_emotions:334 - Emotion analysis successful: Primary=happy (0.591)
2025-04-26 15:45:50.531 | INFO     | app.utils:wrapper:117 - 'Advanced Emotion Analysis' completed successfully in 0.0788 seconds.
2025-04-26 15:45:50.531 | WARNING  | app.llm_service:validate_response:46 - Response emotion mismatch: expected neutral, got happy
2025-04-26 15:45:50.532 | WARNING  | app.llm_service:refine_and_respond:98 - Response validation failed on attempt 2. Retrying...
2025-04-26 15:45:50.532 | WARNING  | app.llm_service:refine_and_respond:108 - Max validation attempts reached. Using fallback.
2025-04-26 15:45:50.532 | INFO     | app.utils:wrapper:117 - 'LLM Emotion + Response' completed successfully in 2.7844 seconds.
2025-04-26 15:45:50.532 | INFO     | app.main:chat_endpoint:127 - [ReqID: req_be68ce9e] Skipped caching due to low-confidence emotion (score: 0.46569).
2025-04-26 15:45:50.532 | INFO     | app.main:chat_endpoint:134 - [ReqID: req_be68ce9e] Processed in 2.8745s.
2025-04-26 15:46:46.930 | INFO     | app.main:lifespan:27 - Shutting down...
2025-04-26 15:46:46.932 | INFO     | app.cache:close_redis_pool:53 - Redis connection pool closed.
2025-04-26 15:46:46.932 | INFO     | app.main:lifespan:29 - Shutdown complete.
